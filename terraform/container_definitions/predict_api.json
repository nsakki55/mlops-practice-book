 [
    {
        "name": "predict-api",
        "image": "${ecr_uri}:latest",
        "cpu": 768,
        "memory": 1536,
        "portMappings": [
            {
                "name": "predict-api-8080-tcp",
                "containerPort": 8080,
                "hostPort": 8080,
                "protocol": "tcp",
                "appProtocol": "http"
            }
        ],
        "essential": true,
        "command": [
            "python",
            "src/predictor.py"
        ],
        "environment": [
            {
                "name": "MODEL_NAME",
                "value": "${model_name}"
            },
            {
                "name": "MODEL_VERSION",
                "value": "${model_version}"
            },
            {
              "name": "FEATURE_VERSION",
              "value": "${feature_version}"
            }
        ],
        "logConfiguration": {
              "logDriver": "awsfirelens"
        },
        "dependsOn": [
        {
            "containerName": "fluent-bit",
            "condition": "START"
        }
      ]
    },
    {
    "essential": true,
    "name": "fluent-bit",
    "image": "${fluent_bid_uri}:latest",
    "cpu": 256,
    "memory": 512,
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "/mlops/ecs/fluentbit",
        "awslogs-region": "ap-northeast-1",
        "awslogs-stream-prefix": "ecs",
        "awslogs-create-group": "true"
      }
    },
    "firelensConfiguration": {
      "type": "fluentbit",
      "options": {
        "config-file-type": "file",
        "config-file-value": "/fluent-bit/etc/extra.conf"
      }
    },
    "user" : "0"
  }
]
